{% extends 'dashboard/dashboard_base.html' %} {% block dashboard_title %}Editor
Dashboard{% endblock %} {% block content %}
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
  <div
    class="bg-white dark:bg-card-dark p-6 rounded shadow-card border border-slate-100 dark:border-slate-800/50 flex items-center"
  >
    <div
      class="h-12 w-12 rounded-full bg-green-50 text-primary flex items-center justify-center mr-4"
    >
      <span class="material-icons text-2xl">library_books</span>
    </div>
    <div>
      <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">
        Total Submissions
      </p>
      <p class="text-2xl font-bold text-primary dark:text-white">
        {{ total_count }}
      </p>
    </div>
  </div>
  <div
    class="bg-white dark:bg-card-dark p-6 rounded shadow-card border border-slate-100 dark:border-slate-800/50 flex items-center"
  >
    <div
      class="h-12 w-12 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center mr-4"
    >
      <span class="material-icons text-2xl">assignment_late</span>
    </div>
    <div>
      <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">
        Unassigned
      </p>
      <p class="text-2xl font-bold text-amber-500">{{ unassigned_count }}</p>
    </div>
  </div>
</div>

<!-- Main Submissions Table -->
<div
  class="bg-white dark:bg-card-dark rounded shadow-card overflow-hidden mb-12"
>
  <div
    class="px-8 py-6 border-b border-border-light dark:border-border-dark flex flex-col md:flex-row justify-between items-center gap-4"
  >
    <div class="flex items-center gap-4">
        <h3 class="text-xl font-display font-bold text-slate-800 dark:text-white">
        All Manuscripts
        </h3>
        <!-- Filter & Sort Form -->
        <form method="get" class="flex items-center gap-2" id="dashboard-filters">
            <select name="status" onchange="this.form.submit()" class="text-xs border-gray-200 rounded focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600">
                <option value="all" {% if current_status == 'all' %}selected{% endif %}>All Status</option>
                <option value="submitted" {% if current_status == 'submitted' %}selected{% endif %}>Submitted</option>
                <option value="under_review" {% if current_status == 'under_review' %}selected{% endif %}>Under Review</option>
                <option value="accepted" {% if current_status == 'accepted' %}selected{% endif %}>Accepted</option>
                <option value="published" {% if current_status == 'published' %}selected{% endif %}>Published</option>
                <option value="rejected" {% if current_status == 'rejected' %}selected{% endif %}>Rejected</option>
            </select>
            <select name="sort" onchange="this.form.submit()" class="text-xs border-gray-200 rounded focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600">
                <option value="date_desc" {% if current_sort == 'date_desc' %}selected{% endif %}>Neewest</option>
                <option value="date_asc" {% if current_sort == 'date_asc' %}selected{% endif %}>Oldest</option>
                <option value="title" {% if current_sort == 'title' %}selected{% endif %}>Title</option>
            </select>
            <!-- Preserve search -->
            {% if current_search %}<input type="hidden" name="search" value="{{ current_search }}">{% endif %}
        </form>
    </div>
    
    <div class="flex space-x-3 items-center w-full md:w-auto">
      <div class="relative">
        <form method="get"> <!-- Simple GET form for search -->
            <!-- Preserve other filters -->
            {% if current_status %}<input type="hidden" name="status" value="{{ current_status }}">{% endif %}
            {% if current_sort %}<input type="hidden" name="sort" value="{{ current_sort }}">{% endif %}
            
            <span
            class="material-icons absolute left-3 top-2.5 text-gray-400 text-sm"
            >search</span
            >
            <input
            type="text"
            name="search"
            value="{{ current_search|default:'' }}"
            placeholder="Search manuscripts..."
            class="pl-10 pr-4 py-2 text-sm border border-gray-300 rounded focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600 w-full md:w-64"
            />
        </form>
      </div>
      <a
        href="{% url 'create_issue' %}"
        class="inline-flex items-center px-4 py-2 bg-primary text-white text-sm font-bold rounded hover:bg-opacity-90 transition shadow-md whitespace-nowrap"
      >
        <span class="material-icons text-sm mr-2">add</span>
        Create Issue</a
      >
    </div>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-100 dark:divide-gray-700">
      <thead class="bg-gray-50/50 dark:bg-gray-800">
        <tr>
          <th
            scope="col"
            class="px-8 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-widest"
          >
            Manuscript
          </th>
          <th
            scope="col"
            class="px-8 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-widest"
          >
            Reviewers
          </th>
          <th
            scope="col"
            class="px-8 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-widest"
          >
            Status
          </th>
          <th
            scope="col"
            class="px-8 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-widest"
          >
            Payment
          </th>
          <th
            scope="col"
            class="px-8 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-widest"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody
        class="bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700"
      >
        {% for manuscript in submissions %}
        <tr
          class="hover:bg-gray-50/80 dark:hover:bg-gray-700/50 transition duration-200 ease-in-out group"
        >
          <td class="px-8 py-5">
            <div
              class="text-sm font-bold text-slate-800 dark:text-white group-hover:text-primary transition-colors"
            >
              <a href="{% url 'dashboard_manuscript_detail' manuscript.id %}" class="hover:underline">
                {{ manuscript.title }}
              </a>
            </div>
            <div class="text-xs text-slate-500 mt-1.5 flex items-center gap-2">
              <span class="font-semibold text-slate-600"
                >{{ manuscript.author.username }}</span
              >
              <span class="text-gray-300">•</span>
              <span>{{ manuscript.submitted_date|date:"M d, Y" }}</span>
            </div>
          </td>
          <td class="px-8 py-5 whitespace-nowrap">
            <div class="flex -space-x-2 overflow-hidden">
              {% for review in manuscript.reviews.all %}
              <div
                class="inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-gray-800 flex items-center justify-center text-xs font-bold text-white shadow-sm {% if review.date_completed %}bg-green-500{% else %}bg-slate-400{% endif %}"
                title="{{ review.reviewer.username }} ({% if review.date_completed %}Completed{% else %}Pending{% endif %})"
              >
                {{ review.reviewer.username|slice:":1"|upper }}
              </div>
              {% empty %}
              <span class="text-xs text-slate-400 italic">Unassigned</span>
              {% endfor %}
            </div>
          </td>
          <td class="px-8 py-5 whitespace-nowrap">
            <span
              class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full {% if manuscript.status == 'accepted' %}bg-green-50 text-green-600 ring-1 ring-green-600/20 {% elif manuscript.status == 'rejected' %}bg-red-50 text-red-600 ring-1 ring-red-600/20 {% elif manuscript.status == 'under_review' %}bg-amber-50 text-amber-600 ring-1 ring-amber-600/20 {% else %}bg-blue-50 text-blue-600 ring-1 ring-blue-600/20{% endif %}"
            >
              {{ manuscript.get_status_display }}
            </span>
          </td>
          <td class="px-8 py-5 text-center">
             {% if manuscript.is_paid %}
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700">
                  <span class="material-icons text-xs mr-1">check_circle</span> Paid
                </span>
            {% else %}
                <a
                href="{% url 'mark_as_paid' manuscript.id %}"
                class="inline-block text-amber-600 hover:text-white hover:bg-amber-500 dark:text-amber-400 font-medium text-xs border border-amber-200 dark:border-amber-900 bg-amber-50 dark:bg-amber-900/20 px-3 py-1.5 rounded transition-all shadow-sm whitespace-nowrap"
                onclick="return confirm('Confirm payment for {{manuscript.title}}?');"
                >Mark Paid</a>
            {% endif %}
          </td>
          <td
            class="px-8 py-5 whitespace-nowrap text-right text-sm font-medium"
          >
            <div class="flex justify-end space-x-2">
              <a
                href="{% url 'assign_reviewer' manuscript.id %}"
                class="text-slate-600 hover:text-white hover:bg-primary dark:text-blue-400 font-medium text-xs border border-slate-200 dark:border-blue-900 bg-white dark:bg-blue-900/20 px-3 py-1.5 rounded transition-all shadow-sm"
                >Assign</a
              >
              <a
                href="{% url 'make_decision' manuscript.id %}"
                class="text-slate-600 hover:text-white hover:bg-amber-500 dark:text-amber-400 font-medium text-xs border border-slate-200 dark:border-amber-900 bg-white dark:bg-amber-900/20 px-3 py-1.5 rounded transition-all shadow-sm"
                >Decide</a
              >
              {% if manuscript.status == 'published' %}
                  <span
                    class="text-gray-400 font-medium text-xs border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 px-3 py-1.5 rounded cursor-not-allowed opacity-75 shadow-sm"
                    >Published</span
                  >
              {% elif manuscript.status == 'accepted' %}
                  <a
                    href="{% url 'publish_article' manuscript.id %}"
                    class="text-green-600 hover:text-white hover:bg-green-600 dark:text-green-400 font-medium text-xs border border-green-200 dark:border-green-900 bg-green-50 dark:bg-green-900/20 px-3 py-1.5 rounded transition-all shadow-sm"
                    >Publish</a
                  >
              {% else %}
                  <span
                    class="text-gray-400 font-medium text-xs border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 px-3 py-1.5 rounded cursor-not-allowed opacity-50 shadow-sm"
                    >Publish</span
                  >
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
    <!-- Pagination -->
    <div class="bg-white dark:bg-card-dark px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6">
        <div class="flex items-center justify-between">
            <div class="flex-1 flex justify-between sm:hidden">
                {% if submissions.has_previous %}
                    <a href="?page={{ submissions.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">Previous</a>
                {% else %}
                    <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-300 bg-gray-50 cursor-not-allowed">Previous</span>
                {% endif %}
                
                {% if submissions.has_next %}
                    <a href="?page={{ submissions.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">Next</a>
                {% else %}
                    <span class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-300 bg-gray-50 cursor-not-allowed">Next</span>
                {% endif %}
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700 dark:text-gray-300">
                        Showing
                        <span class="font-medium">{{ submissions.start_index }}</span>
                        to
                        <span class="font-medium">{{ submissions.end_index }}</span>
                        of
                        <span class="font-medium">{{ submissions.paginator.count }}</span>
                        results
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        {% if submissions.has_previous %}
                            <a href="?page={{ submissions.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="material-icons text-sm">chevron_left</span>
                            </a>
                        {% else %}
                             <span class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-gray-50 text-sm font-medium text-gray-300 cursor-not-allowed">
                                <span class="material-icons text-sm">chevron_left</span>
                            </span>
                        {% endif %}
                        
                        <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                            Page {{ submissions.number }} of {{ submissions.paginator.num_pages }}
                        </span>

                        {% if submissions.has_next %}
                            <a href="?page={{ submissions.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="material-icons text-sm">chevron_right</span>
                            </a>
                        {% else %}
                             <span class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-gray-50 text-sm font-medium text-gray-300 cursor-not-allowed">
                                <span class="material-icons text-sm">chevron_right</span>
                            </span>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- My Personal Submissions (If any) -->
{% if my_submissions %}
<div class="mt-12 border-t border-slate-200 dark:border-slate-800 pt-10">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h2
        class="text-2xl font-bold font-display text-slate-800 dark:text-white"
      >
        Your Manuscripts
      </h2>
      <p class="text-slate-500 text-sm mt-1">
        Status of your personal submissions.
      </p>
    </div>
  </div>

  <div class="space-y-6">
    {% for manuscript in my_submissions %}
    <div
      class="bg-white dark:bg-card-dark rounded shadow-card overflow-hidden border border-slate-100 dark:border-slate-800/50 hover:shadow-lg transition-shadow duration-300"
    >
      <div class="p-6">
        <div class="flex flex-col md:flex-row justify-between mb-6 gap-4">
          <div>
            <h3
              class="text-lg font-bold font-display text-slate-800 dark:text-white"
            >
              {{ manuscript.title }}
            </h3>
            <p class="text-sm text-slate-500 mt-1 font-medium">
              Submitted on {{ manuscript.submitted_date|date:"F d, Y" }}
            </p>
          </div>
          <div class="flex-shrink-0">
            <span
              class="px-3 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest border {% if manuscript.status == 'accepted' %}bg-green-50 text-green-600 border-green-200 {% elif manuscript.status == 'rejected' %}bg-red-50 text-red-600 border-red-200 {% elif manuscript.status == 'under_review' %}bg-amber-50 text-amber-600 border-amber-200 {% else %}bg-blue-50 text-blue-600 border-blue-200{% endif %}"
            >
              {{ manuscript.get_status_display }}
            </span>
          </div>
        </div>

        <!-- Progress Tracker -->
        <div class="relative mt-4">
          <div
            class="overflow-hidden h-2.5 mb-2 text-xs flex rounded-full bg-slate-100 dark:bg-slate-700"
          >
            <div
              class="flex flex-col text-center whitespace-nowrap text-white justify-center {{ manuscript.progress_width_class }} {{ manuscript.progress_color_class }} shadow-sm transition-all duration-1000 ease-in-out"
            ></div>
          </div>
          <div
            class="flex justify-between text-[10px] sm:text-xs text-slate-400 font-bold uppercase tracking-widest"
          >
            <div
              class="{% if manuscript.status != '' %}text-primary dark:text-green-400{% endif %} transition-colors"
            >
              Submitted
            </div>
            <div
              class="{% if manuscript.status == 'under_review' or manuscript.status == 'accepted' or manuscript.status == 'rejected' %}text-primary dark:text-green-400{% endif %} transition-colors"
            >
              Under Review
            </div>
            <div
              class="{% if manuscript.status == 'accepted' %}text-green-600 dark:text-green-400{% elif manuscript.status == 'rejected' %}text-red-600 dark:text-red-400{% endif %} transition-colors"
            >
              Decision
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
      My Submissions
    </h3>
    <a
      href="{% url 'submit_manuscript' %}"
      class="text-sm font-bold text-primary hover:underline"
      >+ New Submission</a
    >
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for manuscript in my_submissions %}
    <div
      class="bg-gray-50 dark:bg-gray-800 rounded p-5 border border-border-light dark:border-border-dark"
    >
      <div class="flex justify-between items-start mb-2">
        <span class="text-xs font-bold text-gray-500">
          {{ manuscript.submitted_date|date:"F d, Y" }}
        </span>
        <span
          class="px-2 py-0.5 rounded text-xs font-bold {% if manuscript.status == 'accepted' %}bg-green-100 text-green-800 {% elif manuscript.status == 'rejected' %}bg-red-100 text-red-800 {% else %}bg-blue-100 text-blue-800{% endif %}"
        >
          {{ manuscript.get_status_display }}
        </span>
      </div>
      <h4 class="font-bold text-lg text-primary mb-1">
        {{ manuscript.title }}
      </h4>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %} {% endblock %}
