{% extends 'dashboard/dashboard_base.html' %}
<!-- My Submissions Page -->
{% block dashboard_title %}My Submissions{% endblock %} {% block content %}
<div class="flex justify-between items-center mb-8">
  <div>
    <h2 class="text-2xl font-bold font-display text-slate-800 dark:text-white">
      Your Manuscripts
    </h2>
    <p class="text-slate-500 text-sm mt-1">
      Track the status of your submitted papers.
    </p>
  </div>
  <a
    href="{% url 'submit_manuscript' %}"
    class="flex items-center bg-primary text-white font-bold py-2.5 px-5 rounded hover:bg-opacity-90 transition shadow-md hover:shadow-lg"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 mr-2"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M12 4v16m8-8H4"
      />
    </svg>
    New Submission
  </a>
</div>

{% if submissions %}
<!-- Filters -->
<div class="mb-4">
    <form method="get" class="flex items-center gap-2" id="submissions-filters">
        <select name="status" onchange="this.form.submit()" class="text-xs border-gray-200 rounded focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600">
            <option value="all" {% if current_status == 'all' %}selected{% endif %}>All Status</option>
            <option value="submitted" {% if current_status == 'submitted' %}selected{% endif %}>Submitted</option>
            <option value="under_review" {% if current_status == 'under_review' %}selected{% endif %}>Under Review</option>
            <option value="accepted" {% if current_status == 'accepted' %}selected{% endif %}>Accepted</option>
            <option value="published" {% if current_status == 'published' %}selected{% endif %}>Published</option>
            <option value="rejected" {% if current_status == 'rejected' %}selected{% endif %}>Rejected</option>
        </select>
        <select name="sort" onchange="this.form.submit()" class="text-xs border-gray-200 rounded focus:ring-primary focus:border-primary dark:bg-gray-700 dark:border-gray-600">
            <option value="date_desc" {% if current_sort == 'date_desc' %}selected{% endif %}>Newest</option>
            <option value="date_asc" {% if current_sort == 'date_asc' %}selected{% endif %}>Oldest</option>
            <option value="title" {% if current_sort == 'title' %}selected{% endif %}>Title</option>
        </select>
    </form>
</div>

<div
  class="bg-white dark:bg-card-dark rounded shadow-card overflow-hidden border border-slate-200 dark:border-slate-800/50"
>
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-100 dark:divide-slate-800">
      <thead class="bg-slate-50 dark:bg-slate-900/50">
        <tr>
          <th
            scope="col"
            class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider"
          >
            Manuscript
          </th>
          <th
            scope="col"
            class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider"
          >
            Date Submitted
          </th>
          <th
            scope="col"
            class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider"
          >
            Status
          </th>
          <th
            scope="col"
            class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider"
          >
            Payment
          </th>
          <th
            scope="col"
            class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
        {% for manuscript in submissions %}
        <tr
          class="hover:bg-slate-50/50 dark:hover:bg-slate-800/50 transition-colors"
        >
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div
                class="flex-shrink-0 h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary dark:text-green-400"
              >
                <span class="material-icons text-xl">description</span>
              </div>
              <div class="ml-4">
                <div
                  class="text-sm font-bold text-slate-900 dark:text-white max-w-xs truncate"
                  title="{{ manuscript.title }}"
                >
                  <a href="{% url 'my_submission_detail' manuscript.id %}" class="hover:text-primary hover:underline">
                    {{ manuscript.title }}
                  </a>
                </div>
                <div class="text-xs text-slate-500">
                  ID: #{{ manuscript.id }}
                </div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-slate-600 dark:text-slate-400">
              {{ manuscript.submitted_date|date:"M d, Y" }}
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span
              class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full border {% if manuscript.status == 'accepted' %}bg-green-50 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-900/30{% elif manuscript.status == 'rejected' %}bg-red-50 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/30{% elif manuscript.status == 'under_review' %}bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-900/30{% else %}bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-900/30{% endif %}"
            >
              {{ manuscript.get_status_display }}
            </span>
          </td>
           <td class="px-6 py-4 whitespace-nowrap">
            {% if manuscript.status == 'accepted' or manuscript.status == 'published' %} {% if manuscript.is_paid %}
            <span
              class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700"
            >
              Paid
            </span>
            {% else %}
            <span
              class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-700 animate-pulse"
            >
              Awaiting Payment
            </span>
            <a
              href="{% url 'publication_fees' %}"
              class="block text-[10px] text-primary hover:underline mt-1 font-medium"
              >View Instructions</a
            >
            {% endif %} {% else %}
            <span class="text-slate-400 text-xs">-</span>
            {% endif %}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <div class="flex items-center space-x-3">
              <!-- View/Edit Link (Depending on status, logic could be refined but mostly View for now) -->
              <!-- Currently no explicit detail view for author, so maybe just a dummy view or link to nothing? 
                    Actually, we don't have a 'manuscript_detail' view for authors yet. 
                    So I will hide the view button or link to '#' for now or maybe 'submit_manuscript' if we want to allow editing?
                    User previously asked for review editing, not manuscript editing.
                    But typically authors want to see their submission.
                    I will add a 'View Logic' place holder or just removal.
                    BUT high end dashboards have actions.
                    Let's just show a 'Check Status' button that does nothing for now or links to same page? 
                    Actually, I'll exclude it if no detail page exists. 
                    Wait, `submit_manuscript` creates new.
                    I will leave it blank for now or add a dummy 'View' button.
               -->
              <!-- Adding a simple 'View' that perhaps opens a modal? No, too complex.
                    Let's just show the ID which is already there. 
                    I'll add a 'Download' button if we had the file URL.
                    Manuscript has 'file'.
               -->
              {% if manuscript.file %}
              <a
                href="{{ manuscript.file.url }}"
                target="_blank"
                class="text-slate-400 hover:text-primary transition-colors flex items-center"
                title="Download PDF"
              >
                <span class="material-icons text-lg">download</span>
              </a>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
    <!-- Pagination -->
    <div class="bg-white dark:bg-card-dark px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6">
        <div class="flex items-center justify-between">
            <div class="flex-1 flex justify-between sm:hidden">
                {% if submissions.has_previous %}
                    <a href="?page={{ submissions.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">Previous</a>
                {% else %}
                    <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-300 bg-gray-50 cursor-not-allowed">Previous</span>
                {% endif %}
                
                {% if submissions.has_next %}
                    <a href="?page={{ submissions.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">Next</a>
                {% else %}
                     <span class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-300 bg-gray-50 cursor-not-allowed">Next</span>
                {% endif %}
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700 dark:text-gray-300">
                        Showing
                        <span class="font-medium">{{ submissions.start_index }}</span>
                        to
                        <span class="font-medium">{{ submissions.end_index }}</span>
                        of
                        <span class="font-medium">{{ submissions.paginator.count }}</span>
                        results
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        {% if submissions.has_previous %}
                            <a href="?page={{ submissions.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="material-icons text-sm">chevron_left</span>
                            </a>
                        {% else %}
                             <span class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-gray-50 text-sm font-medium text-gray-300 cursor-not-allowed">
                                <span class="material-icons text-sm">chevron_left</span>
                            </span>
                        {% endif %}
                        
                        <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                            Page {{ submissions.number }} of {{ submissions.paginator.num_pages }}
                        </span>

                        {% if submissions.has_next %}
                            <a href="?page={{ submissions.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="material-icons text-sm">chevron_right</span>
                            </a>
                        {% else %}
                             <span class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-gray-50 text-sm font-medium text-gray-300 cursor-not-allowed">
                                <span class="material-icons text-sm">chevron_right</span>
                            </span>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div
  class="bg-white dark:bg-card-dark rounded shadow-card p-12 text-center border border-slate-100 dark:border-slate-800/50"
>
  <div
    class="mx-auto h-20 w-20 bg-slate-50 dark:bg-slate-800 rounded-full flex items-center justify-center mb-6 shadow-sm"
  >
    <span class="material-icons text-4xl text-slate-300">note_add</span>
  </div>
  <h3 class="text-xl font-bold font-display text-slate-800 dark:text-white">
    No Manuscripts Yet
  </h3>
  <p class="text-slate-500 mt-2 mb-8 max-w-sm mx-auto">
    Start your journey by submitting your first research paper to JHST.
  </p>
  <a
    href="{% url 'submit_manuscript' %}"
    class="inline-flex items-center bg-primary text-white font-bold py-3 px-8 rounded hover:bg-opacity-90 transition shadow-md hover:shadow-lg"
  >
    <span class="material-icons text-sm mr-2">upload_file</span>
    Submit Manuscript
  </a>
</div>
{% endif %} {% endblock %}
